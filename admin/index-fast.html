<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Ph√≤ng Kh√°m Si√™u √Çm</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .appointment-card {
            border-left: 4px solid #007bff;
            margin-bottom: 1rem;
        }
        .appointment-card.urgent {
            border-left-color: #dc3545;
        }
        .appointment-card.completed {
            border-left-color: #28a745;
        }
        .status-badge {
            font-size: 0.8rem;
        }
        .filter-section {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fas fa-user-md me-2"></i>
                Qu·∫£n L√Ω L·ªãch Si√™u √Çm
            </a>
            <div class="navbar-nav ms-auto">
                <span class="navbar-text">
                    <i class="fas fa-user me-2"></i>
                    BS. Tr·∫ßn Trung ƒê·ª©c (Nam - ƒêeo k√≠nh)
                </span>
                <a class="nav-link" href="../index.html">
                    <i class="fas fa-home me-1"></i>
                    V·ªÅ Trang Ch·ªß
                </a>
                <a class="nav-link" href="#" onclick="logout()">
                    <i class="fas fa-sign-out-alt me-2"></i>ƒêƒÉng Xu·∫•t
                </a>
            </div>
        </div>
    </nav>

    <!-- Dashboard -->
    <div class="container mt-4">
        <!-- Statistics Cards -->
        <div class="row mb-4">
            <div class="col-md-3 mb-3">
                <div class="card bg-primary text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h4 class="card-title">H√¥m Nay</h4>
                                <h2 id="today-count">0</h2>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-calendar-day fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card bg-success text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h4 class="card-title">Tu·∫ßn N√†y</h4>
                                <h2 id="week-count">0</h2>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-calendar-week fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card bg-warning text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h4 class="card-title">Ch·ªù X√°c Nh·∫≠n</h4>
                                <h2 id="pending-count">0</h2>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-clock fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card bg-info text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between">
                            <div>
                                <h4 class="card-title">T·ªïng C·ªông</h4>
                                <h2 id="total-count">0</h2>
                            </div>
                            <div class="align-self-center">
                                <i class="fas fa-calendar fa-2x"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filters -->
        <div class="filter-section">
            <div class="row">
                <div class="col-md-3 mb-3">
                    <label for="date-filter" class="form-label fw-bold">Ch·ªçn Ng√†y:</label>
                    <input type="date" id="date-filter" class="form-control">
                </div>
                <div class="col-md-3 mb-3">
                    <label for="status-filter" class="form-label fw-bold">Tr·∫°ng Th√°i:</label>
                    <select id="status-filter" class="form-select">
                        <option value="">T·∫•t c·∫£</option>
                        <option value="pending">Ch·ªù x√°c nh·∫≠n</option>
                        <option value="confirmed">ƒê√£ x√°c nh·∫≠n</option>
                        <option value="completed">ƒê√£ ho√†n th√†nh</option>
                        <option value="cancelled">ƒê√£ h·ªßy</option>
                    </select>
                </div>
                <div class="col-md-3 mb-3">
                    <label for="service-filter" class="form-label fw-bold">D·ªãch V·ª•:</label>
                    <select id="service-filter" class="form-select">
                        <option value="">T·∫•t c·∫£</option>
                        <option value="ultrasound-general">Si√™u √Çm T·ªïng Qu√°t</option>
                        <option value="ultrasound-obstetrics">Si√™u √Çm S·∫£n - Ph·ª• Khoa</option>
                        <option value="ultrasound-cardio">Si√™u √Çm Tim - M·∫°ch M√°u</option>
                        <option value="ultrasound-ortho">Si√™u √Çm C∆° - X∆∞∆°ng - Kh·ªõp</option>
                        <option value="additional-services">D·ªãch V·ª• K√®m Theo</option>
                        <option value="regular-checkup">Kh√°m ƒê·ªãnh K·ª≥</option>
                    </select>
                </div>
                <div class="col-md-3 mb-3">
                    <label class="form-label fw-bold">Thao T√°c:</label>
                    <div class="d-grid gap-2">
                        <button class="btn btn-primary" onclick="refreshAppointments()">
                            <i class="fas fa-sync-alt me-2"></i>L√†m M·ªõi
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Appointments List -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-list me-2"></i>
                            Danh S√°ch L·ªãch H·∫πn
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="appointments-list">
                            <!-- Appointments will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Fast Admin Dashboard - Simplified Version
        let appointments = [];
        let currentAppointment = null;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Fast admin dashboard loading...');
            
            // Check authentication
            const isAuth = localStorage.getItem('adminAuthenticated');
            if (isAuth !== 'true') {
                window.location.href = 'login-simple.html';
                return;
            }
            
            // Load data and setup
            loadAppointmentsFromStorage();
            loadAppointments();
            updateStatistics();
            setupEventListeners();
            
            console.log('‚úÖ Fast dashboard loaded!');
        });

        // Load appointments from localStorage
        function loadAppointmentsFromStorage() {
            const stored = localStorage.getItem('appointments');
            if (stored) {
                appointments = JSON.parse(stored);
                console.log(`üìã Loaded ${appointments.length} appointments from storage`);
            }
        }

        // Setup event listeners
        function setupEventListeners() {
            const debouncedFilter = debounce(filterAppointments, 300);
            
            document.getElementById('date-filter').addEventListener('change', debouncedFilter);
            document.getElementById('status-filter').addEventListener('change', debouncedFilter);
            document.getElementById('service-filter').addEventListener('change', debouncedFilter);
            
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date-filter').value = today;
        }

        // Debounce function
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Load appointments
        function loadAppointments() {
            const appointmentsList = document.getElementById('appointments-list');
            appointmentsList.innerHTML = '';
            
            if (appointments.length === 0) {
                appointmentsList.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-calendar-times fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">Kh√¥ng c√≥ l·ªãch h·∫πn n√†o</h5>
                        <p class="text-muted">Ch∆∞a c√≥ b·ªánh nh√¢n n√†o ƒë·∫∑t l·ªãch h·∫πn.</p>
                    </div>
                `;
                return;
            }
            
            // Sort appointments
            const sortedAppointments = appointments.sort((a, b) => {
                const dateA = new Date(a.date + ' ' + a.time);
                const dateB = new Date(b.date + ' ' + b.time);
                return dateA - dateB;
            });
            
            // Create fragment for better performance
            const fragment = document.createDocumentFragment();
            
            sortedAppointments.forEach(appointment => {
                const card = createAppointmentCard(appointment);
                fragment.appendChild(card);
            });
            
            appointmentsList.appendChild(fragment);
        }

        // Create appointment card
        function createAppointmentCard(appointment) {
            const card = document.createElement('div');
            card.className = `card appointment-card ${getStatusClass(appointment.status)}`;
            card.setAttribute('data-appointment-id', appointment.id);
            
            const statusText = getStatusText(appointment.status);
            const statusClass = getStatusBadgeClass(appointment.status);
            
            const formattedDate = new Date(appointment.date).toLocaleDateString('vi-VN', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            
            card.innerHTML = `
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h6 class="card-title mb-0">
                                    <i class="fas fa-user me-2"></i>
                                    ${appointment.patientName}
                                </h6>
                                <span class="badge ${statusClass} status-badge">${statusText}</span>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <p class="mb-1"><i class="fas fa-calendar me-2"></i>${formattedDate}</p>
                                    <p class="mb-1"><i class="fas fa-clock me-2"></i>${appointment.time}</p>
                                </div>
                                <div class="col-md-6">
                                    <p class="mb-1"><i class="fas fa-stethoscope me-2"></i>${appointment.serviceName}</p>
                                    <p class="mb-1"><i class="fas fa-user-md me-2"></i>${appointment.doctorName}</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-sm btn-primary me-2" onclick="viewAppointment('${appointment.id}')">
                                <i class="fas fa-eye me-1"></i>Xem
                            </button>
                            <button class="btn btn-sm btn-success me-2" onclick="confirmAppointmentById('${appointment.id}')">
                                <i class="fas fa-check me-1"></i>X√°c Nh·∫≠n
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="cancelAppointmentById('${appointment.id}')">
                                <i class="fas fa-times me-1"></i>H·ªßy
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            return card;
        }

        // Status helper functions
        function getStatusClass(status) {
            switch(status) {
                case 'pending': return '';
                case 'confirmed': return 'urgent';
                case 'completed': return 'completed';
                case 'cancelled': return 'completed';
                default: return '';
            }
        }

        function getStatusText(status) {
            switch(status) {
                case 'pending': return 'Ch·ªù x√°c nh·∫≠n';
                case 'confirmed': return 'ƒê√£ x√°c nh·∫≠n';
                case 'completed': return 'ƒê√£ ho√†n th√†nh';
                case 'cancelled': return 'ƒê√£ h·ªßy';
                default: return 'Kh√¥ng x√°c ƒë·ªãnh';
            }
        }

        function getStatusBadgeClass(status) {
            switch(status) {
                case 'pending': return 'bg-warning';
                case 'confirmed': return 'bg-primary';
                case 'completed': return 'bg-success';
                case 'cancelled': return 'bg-danger';
                default: return 'bg-secondary';
            }
        }

        // Filter appointments
        function filterAppointments() {
            const dateFilter = document.getElementById('date-filter').value;
            const statusFilter = document.getElementById('status-filter').value;
            const serviceFilter = document.getElementById('service-filter').value;
            
            let filtered = appointments.filter(appointment => {
                let match = true;
                
                if (dateFilter && appointment.date !== dateFilter) {
                    match = false;
                }
                
                if (statusFilter && appointment.status !== statusFilter) {
                    match = false;
                }
                
                if (serviceFilter && appointment.serviceId !== serviceFilter) {
                    match = false;
                }
                
                return match;
            });
            
            displayFilteredAppointments(filtered);
        }

        // Display filtered appointments
        function displayFilteredAppointments(filteredAppointments) {
            const appointmentsList = document.getElementById('appointments-list');
            appointmentsList.innerHTML = '';
            
            if (filteredAppointments.length === 0) {
                appointmentsList.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-search fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">Kh√¥ng t√¨m th·∫•y l·ªãch h·∫πn</h5>
                        <p class="text-muted">Kh√¥ng c√≥ l·ªãch h·∫πn n√†o ph√π h·ª£p v·ªõi b·ªô l·ªçc.</p>
                    </div>
                `;
                return;
            }
            
            const fragment = document.createDocumentFragment();
            filteredAppointments.forEach(appointment => {
                const card = createAppointmentCard(appointment);
                fragment.appendChild(card);
            });
            
            appointmentsList.appendChild(fragment);
        }

        // Update statistics
        function updateStatistics() {
            const today = new Date().toISOString().split('T')[0];
            const todayAppointments = appointments.filter(a => a.date === today);
            const weekAppointments = getWeekAppointments();
            const pendingAppointments = appointments.filter(a => a.status === 'pending');
            
            document.getElementById('today-count').textContent = todayAppointments.length;
            document.getElementById('week-count').textContent = weekAppointments.length;
            document.getElementById('pending-count').textContent = pendingAppointments.length;
            document.getElementById('total-count').textContent = appointments.length;
        }

        // Get week appointments
        function getWeekAppointments() {
            const today = new Date();
            const weekStart = new Date(today);
            weekStart.setDate(today.getDate() - today.getDay());
            weekStart.setHours(0, 0, 0, 0);
            
            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekStart.getDate() + 6);
            weekEnd.setHours(23, 59, 59, 999);
            
            return appointments.filter(appointment => {
                const appointmentDate = new Date(appointment.date);
                return appointmentDate >= weekStart && appointmentDate <= weekEnd;
            });
        }

        // View appointment
        function viewAppointment(appointmentId) {
            const appointment = appointments.find(a => a.id === appointmentId);
            if (appointment) {
                currentAppointment = appointment;
                alert(`Chi ti·∫øt l·ªãch h·∫πn:\nB·ªánh nh√¢n: ${appointment.patientName}\nNg√†y: ${appointment.date}\nGi·ªù: ${appointment.time}\nD·ªãch v·ª•: ${appointment.serviceName}\nB√°c sƒ©: ${appointment.doctorName}`);
            }
        }

        // Confirm appointment
        function confirmAppointmentById(appointmentId) {
            const appointment = appointments.find(a => a.id === appointmentId);
            if (appointment) {
                appointment.status = 'confirmed';
                updateAppointmentInStorage();
                loadAppointments();
                updateStatistics();
                alert('ƒê√£ x√°c nh·∫≠n l·ªãch h·∫πn!');
            }
        }

        // Cancel appointment
        function cancelAppointmentById(appointmentId) {
            const appointment = appointments.find(a => a.id === appointmentId);
            if (appointment) {
                appointment.status = 'cancelled';
                updateAppointmentInStorage();
                loadAppointments();
                updateStatistics();
                alert('ƒê√£ h·ªßy l·ªãch h·∫πn!');
            }
        }

        // Update appointment in storage
        function updateAppointmentInStorage() {
            localStorage.setItem('appointments', JSON.stringify(appointments));
        }

        // Refresh appointments
        function refreshAppointments() {
            loadAppointmentsFromStorage();
            loadAppointments();
            updateStatistics();
            alert('ƒê√£ l√†m m·ªõi d·ªØ li·ªáu!');
        }

        // Logout
        function logout() {
            localStorage.removeItem('adminAuthenticated');
            localStorage.removeItem('adminLoginTime');
            window.location.href = 'login-simple.html';
        }
    </script>
</body>
</html> 